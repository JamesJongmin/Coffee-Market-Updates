<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Market Updates Archive</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-date-fns/2.0.0/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            line-height: 1.7;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            font-weight: 300;
            margin-bottom: 15px;
        }
        
        .description {
            font-size: 1.1em;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        /* ì°¨íŠ¸ ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
        .dashboard-section {
            margin-bottom: 50px;
        }
        
        .section-title {
            font-size: 2em;
            font-weight: 700;
            color: #8B4513;
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 3px solid #8B4513;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .chart-container:hover {
            transform: translateY(-5px);
        }
        
        .chart-header {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .chart-source {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            font-size: 1.1em;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #8B4513;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #8B4513;
        }
        
        .stat-number {
            font-size: 2.2em;
            font-weight: 700;
            color: #8B4513;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.95em;
            color: #666;
            font-weight: 500;
        }
        
        .search-filter {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            border-color: #8B4513;
            outline: none;
        }
        
        .filter-select {
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 1em;
            background: white;
            cursor: pointer;
        }
        
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .report-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #8B4513;
            cursor: pointer;
        }
        
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .report-date {
            font-size: 0.9em;
            color: #8B4513;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .report-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .report-summary {
            font-size: 0.95em;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .report-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .tag {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .read-more {
            display: inline-flex;
            align-items: center;
            color: #8B4513;
            font-weight: 600;
            text-decoration: none;
            font-size: 0.95em;
            transition: color 0.3s ease;
        }
        
        .read-more:hover {
            color: #A0522D;
        }
        
        .read-more::after {
            content: " â†’";
            margin-left: 5px;
            transition: margin-left 0.3s ease;
        }
        
        .read-more:hover::after {
            margin-left: 10px;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 1.1em;
        }
        
        footer {
            text-align: center;
            padding: 30px 20px;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #eee;
            margin-top: 40px;
            background: white;
            border-radius: 15px;
        }
        
        .footer-links {
            margin-top: 15px;
        }
        
        .footer-links a {
            color: #8B4513;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 500;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        /* ë¡œë”© ìƒíƒœ í‘œì‹œ */
        .reports-loading {
            text-align: center;
            padding: 40px;
            color: #8B4513;
            font-size: 1.1em;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2em;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .reports-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Coffee Market Updates</h1>
            <p class="subtitle">Coffee Futures Market Analysis & Dashboard</p>
            <p class="description">
                ì»¤í”¼ ì„ ë¬¼ ì‹œì¥ ë¶„ì„ ë³´ê³ ì„œ ì•„ì¹´ì´ë¸Œ ë° ì‹¤ì‹œê°„ ì‹œì¥ ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤. <br/>
                ì£¼ê°„ ì‹œì¥ ë™í–¥, ê°€ê²© ë³€ë™ ë° ê¸€ë¡œë²Œ ìˆ˜ê¸‰ í˜„í™©ì„ ì •ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
            </p>
        </header>

        <!-- ì°¨íŠ¸ ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
        <div class="dashboard-section">
            <h2 class="section-title">ğŸ“Š Market Dashboard</h2>
            <div class="charts-grid">
                <!-- Coffee Futures Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Coffee Futures</div>
                        <div class="chart-source">ì¶œì²˜: ICE</div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="loading-spinner" id="loading-coffee">
                            <div class="spinner"></div>
                            ë°ì´í„° ë¡œë”© ì¤‘...
                        </div>
                        <canvas id="coffeeChart" style="display: none;"></canvas>
                    </div>
                </div>

                <!-- USD/BRL Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">ë¯¸êµ­ë‹¬ëŸ¬-ë¸Œë¼ì§ˆí—¤ì•Œ í™˜ìœ¨</div>
                        <div class="chart-source">ì¶œì²˜: LSEG</div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="loading-spinner" id="loading-usd">
                            <div class="spinner"></div>
                            ë°ì´í„° ë¡œë”© ì¤‘...
                        </div>
                        <canvas id="usdChart" style="display: none;"></canvas>
                    </div>
                </div>

                <!-- CFTC Positions Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">CFTC íˆ¬ê¸° í¬ì§€ì…˜ (ìˆœë§¤ìˆ˜)</div>
                        <div class="chart-source">ì¶œì²˜: LSEG</div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="loading-spinner" id="loading-cftc">
                            <div class="spinner"></div>
                            ë°ì´í„° ë¡œë”© ì¤‘...
                        </div>
                        <canvas id="cftcChart" style="display: none;"></canvas>
                    </div>
                </div>

                <!-- ICO Composite Index Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">ICO Composite Index</div>
                        <div class="chart-source">ì¶œì²˜: ICO</div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="loading-spinner" id="loading-ico">
                            <div class="spinner"></div>
                            ë°ì´í„° ë¡œë”© ì¤‘...
                        </div>
                        <canvas id="icoChart" style="display: none;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-box">
                <div class="stat-number" id="totalReports">-</div>
                <div class="stat-label">ì´ ë³´ê³ ì„œ ìˆ˜</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="latestDate">-</div>
                <div class="stat-label">ìµœì‹  ì—…ë°ì´íŠ¸</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">ì£¼ê°„</div>
                <div class="stat-label">ì—…ë°ì´íŠ¸ ì£¼ê¸°</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">KR/EN</div>
                <div class="stat-label">ì–¸ì–´ ì§€ì›</div>
            </div>
        </div>

        <div class="search-filter">
            <div class="filter-row">
                <input type="text" class="search-input" id="searchInput" placeholder="ë³´ê³ ì„œ ì œëª©ì´ë‚˜ ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”...">
                <select class="filter-select" id="yearFilter">
                    <option value="">ì „ì²´ ë…„ë„</option>
                </select>
                <select class="filter-select" id="monthFilter">
                    <option value="">ì „ì²´ ì›”</option>
                </select>
            </div>
        </div>

        <div class="reports-loading" id="reportsLoading">
            <div class="spinner" style="margin: 0 auto 15px;"></div>
            ë³´ê³ ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>

        <div class="reports-grid" id="reportsGrid" style="display: none;">
            <!-- ë³´ê³ ì„œ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>

        <div class="no-results" id="noResults" style="display: none;">
            <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë‚˜ í•„í„°ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.</p>
        </div>

        <footer>
            <p><strong>Published by Align Commodities & Yellowknife </strong></p>
            <p>ì „ë¬¸ì ì¸ ì»¤í”¼ ì‹œì¥ ë¶„ì„ê³¼ Market Intelligenceë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
            <div class="footer-links">
                <a href="mailto:james.baek@aligncommodities.com">Contact</a>
                <a href="https://github.com/jamesjongmin/Coffee-Market-Updates">GitHub</a>
                <a href="#latest">Latest Report</a>
            </div>
            <p style="margin-top: 15px; font-size: 0.8em; opacity: 0.7;">
                ë³¸ ë¦¬í¬íŠ¸ëŠ” ì •ë³´ ì œê³µ ëª©ì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, íˆ¬ì ê¶Œìœ ê°€ ì•„ë‹™ë‹ˆë‹¤.
            </p>
        </footer>
    </div>

<script>
        let allReports = [];
        let charts = {};

        // Excel íŒŒì¼ ì½ê¸° í•¨ìˆ˜
        async function readExcelFile(filename) {
            try {
                console.log(`Excel íŒŒì¼ ë¡œë”© ì‹œë„: ${filename}`);
                
                // íƒ€ì„ì•„ì›ƒ ì„¤ì • (15ì´ˆ)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000);
                
                const response = await fetch(filename, {
                    signal: controller.signal,
                    cache: 'no-cache', // ìºì‹œ ë¬´ì‹œ
                    headers: {
                        'Accept': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
                    }
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    console.error(`íŒŒì¼ ë¡œë”© ì‹¤íŒ¨: ${filename}, ìƒíƒœ: ${response.status}`);
                    throw new Error(`Failed to fetch ${filename} - Status: ${response.status}`);
                }
                
                console.log(`${filename} ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨, í¬ê¸°: ${response.headers.get('content-length')} bytes`);
                
                const arrayBuffer = await response.arrayBuffer();
                console.log(`${filename} ArrayBuffer í¬ê¸°: ${arrayBuffer.byteLength} bytes`);
                
                if (arrayBuffer.byteLength === 0) {
                    throw new Error(`${filename} íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤`);
                }
                
                const workbook = XLSX.read(arrayBuffer, {
                    type: 'array',
                    cellDates: true,
                    cellNF: false,
                    cellText: false
                });
                
                console.log(`${filename} ì›Œí¬ë¶ ì‹œíŠ¸ ëª©ë¡:`, workbook.SheetNames);
                
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                const data = XLSX.utils.sheet_to_json(worksheet, { 
                    header: 1,
                    defval: null,
                    raw: false
                });
                
                console.log(`${filename} ì›ë³¸ ë°ì´í„° í–‰ ìˆ˜:`, data.length);
                console.log(`${filename} ì²« 3í–‰:`, data.slice(0, 3));
                
                // ì²« ë²ˆì§¸ í–‰ì€ í—¤ë”, ë‘ ë²ˆì§¸ í–‰ì€ "Close" ë“±ì˜ ì¶”ê°€ í—¤ë”ì´ë¯€ë¡œ 3ë²ˆì§¸ í–‰ë¶€í„° ë°ì´í„°
                const dataRows = data.slice(2);
                
                const processedData = dataRows.map((row, index) => {
                    const dateValue = row[0];
                    const priceValue = row[1];
                    
                    if (!dateValue || priceValue === null || priceValue === undefined || priceValue === '') {
                        return null;
                    }
                    
                    return {
                        date: dateValue,
                        value: priceValue
                    };
                }).filter(row => row !== null);
                
                console.log(`${filename} ì²˜ë¦¬ëœ ë°ì´í„° í¬ì¸íŠ¸:`, processedData.length);
                console.log(`${filename} ì²˜ë¦¬ëœ ì²« 3ê°œ ë°ì´í„°:`, processedData.slice(0, 3));
                console.log(`${filename} ì²˜ë¦¬ëœ ë§ˆì§€ë§‰ 3ê°œ ë°ì´í„°:`, processedData.slice(-3));
                
                if (processedData.length === 0) {
                    throw new Error(`${filename}ì—ì„œ ìœ íš¨í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                }
                
                // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ì˜¤ë˜ëœ ê²ƒ â†’ ìµœì‹  ìˆœì„œë¡œ)
                processedData.sort((a, b) => parseDate(a.date) - parseDate(b.date));
                
                return processedData;
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.error(`${filename} ë¡œë”© íƒ€ì„ì•„ì›ƒ (15ì´ˆ ì´ˆê³¼)`);
                    throw new Error(`${filename} ë¡œë”© íƒ€ì„ì•„ì›ƒ`);
                }
                console.error(`Error reading ${filename}:`, error);
                throw error;
            }
        }

        // ë‚ ì§œ ë³€í™˜ í•¨ìˆ˜
        function parseDate(dateValue) {
            if (typeof dateValue === 'number') {
                // Excel ë‚ ì§œ ì‹œë¦¬ì–¼ ë²ˆí˜¸ì¸ ê²½ìš°
                const date = new Date((dateValue - 25569) * 86400 * 1000);
                return date;
            } else if (typeof dateValue === 'string') {
                return new Date(dateValue);
            }
            return new Date(dateValue);
        }

        // ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜ë“¤ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        async function createCoffeeChart() {
            const data = await readExcelFile('coffeefutures.xlsx');
            const loadingElement = document.getElementById('loading-coffee');
            const chartElement = document.getElementById('coffeeChart');
            
            if (!data) {
                loadingElement.innerHTML = '<div style="color: #e74c3c;">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</div>';
                return;
            }

            const chartData = data.map((row, index) => ({
                x: index,
                y: parseFloat(row.value),
                date: parseDate(row.date)
            })).filter(point => !isNaN(point.y));

            // ë‚ ì§œ ë¼ë²¨ ìƒì„± (3-6ê°œì›” ê°„ê²©)
            const dateLabels = [];
            const totalPoints = chartData.length;
            const interval = Math.max(1, Math.floor(totalPoints / 6)); // ì•½ 6ê°œ êµ¬ê°„
            
            for (let i = 0; i < totalPoints; i += interval) {
                if (chartData[i]) {
                    const date = chartData[i].date;
                    dateLabels.push({
                        index: i,
                        label: date.toLocaleDateString('ko-KR', { 
                            year: '2-digit', 
                            month: 'short' 
                        })
                    });
                }
            }

            loadingElement.style.display = 'none';
            chartElement.style.display = 'block';

            const ctx = chartElement.getContext('2d');
            charts.ico = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'ICO Composite Index',
                        data: chartData,
                        borderColor: '#9B59B6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex;
                                    return chartData[index].date.toLocaleDateString('ko-KR');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Date'
                            },
                            ticks: {
                                callback: function(value, index, values) {
                                    const label = dateLabels.find(dl => dl.index === value);
                                    return label ? label.label : '';
                                },
                                maxTicksLimit: 8
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'I-CIP (cents/lb)'
                            }
                        }
                    }
                }
            });
        }

        // ë™ì ìœ¼ë¡œ Reports í´ë”ë¥¼ ìŠ¤ìº”í•˜ê³  ë©”íƒ€ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
        async function scanReportsFolder() {
            console.log('ë™ì  ë³´ê³ ì„œ ìŠ¤ìº” ì‹œì‘...');
            const reports = [];
            
            // ìŠ¤ìº”í•  í´ë” íŒ¨í„´ë“¤ (ìµœê·¼ 6ê°œì›”)
            const now = new Date();
            const patterns = [];
            
            for (let monthOffset = 0; monthOffset < 6; monthOffset++) {
                const targetDate = new Date(now.getFullYear(), now.getMonth() - monthOffset, 1);
                const year = targetDate.getFullYear();
                const month = String(targetDate.getMonth() + 1).padStart(2, '0');
                patterns.push(`Reports/${year}/${month}/`);
            }
            
            for (const pattern of patterns) {
                try {
                    const files = await scanFolderForHTMLFiles(pattern);
                    console.log(`${pattern}ì—ì„œ ${files.length}ê°œ íŒŒì¼ ë°œê²¬`);
                    
                    for (const file of files) {
                        const metadata = await extractHTMLMetadata(file);
                        if (metadata) {
                            reports.push(metadata);
                            console.log(`ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì™„ë£Œ: ${metadata.title}`);
                        }
                    }
                } catch (error) {
                    console.warn(`${pattern} ìŠ¤ìº” ì‹¤íŒ¨:`, error);
                }
            }
            
            return reports.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        // HTML íŒŒì¼ì—ì„œ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
        async function extractHTMLMetadata(filePath) {
            try {
                console.log(`ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì¤‘: ${filePath}`);
                const response = await fetch(filePath);
                if (!response.ok) return null;
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // ì œëª© ì¶”ì¶œ (ìš°ì„ ìˆœìœ„: h1 > title)
                let title = doc.querySelector('h1')?.textContent?.trim();
                if (!title) {
                    title = doc.querySelector('title')?.textContent?.trim();
                }
                if (!title || title.includes('Coffee Market Updates')) {
                    title = 'ì»¤í”¼ ì„ ë¬¼ ì‹œì¥ ë¶„ì„';
                }
                
                // ë¶€ì œëª© ì¶”ì¶œ
                let subtitle = doc.querySelector('.subtitle')?.textContent?.trim();
                if (!subtitle) {
                    subtitle = doc.querySelector('h2')?.textContent?.trim() || '';
                }
                
                // ìš”ì•½ ì¶”ì¶œ (Executive Summaryì—ì„œ)
                let summary = '';
                const executiveSummary = doc.querySelector('.executive-summary p');
                if (executiveSummary) {
                    summary = executiveSummary.textContent.trim();
                    // HTML íƒœê·¸ë‚˜ íŠ¹ìˆ˜ë¬¸ì ì œê±°
                    summary = summary.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ');
                } else {
                    // ëŒ€ì²´: ì²« ë²ˆì§¸ ë¬¸ë‹¨
                    const firstP = doc.querySelector('p');
                    if (firstP) {
                        summary = firstP.textContent.trim();
                        summary = summary.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ');
                    }
                }
                
                // ìš”ì•½ ê¸¸ì´ ì œí•œ
                if (summary.length > 200) {
                    summary = summary.substring(0, 200) + '...';
                }
                
                if (!summary) {
                    summary = 'ì»¤í”¼ ì„ ë¬¼ ì‹œì¥ì˜ ìµœì‹  ë™í–¥ê³¼ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.';
                }
                
                // ìŠ¤ë§ˆíŠ¸ íƒœê·¸ ì¶”ì¶œ ì‹œìŠ¤í…œ
                const tags = await extractSmartTags(doc, filePath);
                
                // íŒŒì¼ëª…ì—ì„œ ë‚ ì§œ ì¶”ì¶œ
                const fileNameMatch = filePath.match(/(\d{4})-(\d{2})-(\d{2})\.html/);
                if (!fileNameMatch) return null;
                
                const [, year, month, day] = fileNameMatch;
                const date = `${year}-${month}-${day}`;
                const displayDate = `${year}ë…„ ${parseInt(month)}ì›” ${parseInt(day)}ì¼`;
                
                return {
                    date,
                    displayDate,
                    title,
                    subtitle,
                    summary,
                    tags: [...new Set(tags)].slice(0, 8), // ì¤‘ë³µ ì œê±° ë° ìµœëŒ€ 8ê°œ
                    link: filePath,
                    year,
                    month: month.padStart(2, '0')
                };
                
            } catch (error) {
                console.error(`ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨ ${filePath}:`, error);
                return null;
            }
        }

        // ìŠ¤ë§ˆíŠ¸ íƒœê·¸ ì¶”ì¶œ ì‹œìŠ¤í…œ
        async function extractSmartTags(doc, filePath) {
            const tags = new Set();
            
            // 1. ê¸°ì¡´ íƒœê·¸ ìš°ì„  ì¶”ì¶œ
            const existingTags = doc.querySelectorAll('.tag, .tags span');
            existingTags.forEach(el => {
                const tagText = el.textContent.trim();
                if (tagText && tagText.length < 20 && tagText.length > 1) {
                    tags.add(tagText);
                }
            });
            
            // 2. ê¸°ì¡´ íƒœê·¸ê°€ ì¶©ë¶„í•˜ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            if (tags.size >= 5) {
                return Array.from(tags);
            }
            
            // 3. ì»¨í…ì¸  ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ íƒœê·¸ ìƒì„±
            const bodyText = doc.body.textContent.toLowerCase();
            const titleText = (doc.querySelector('h1')?.textContent || '').toLowerCase();
            const summaryText = (doc.querySelector('.executive-summary p, .main-story p')?.textContent || '').toLowerCase();
            
            // í•µì‹¬ í‚¤ì›Œë“œ ì‚¬ì „ (ì¹´í…Œê³ ë¦¬ë³„)
            const keywordCategories = {
                'ì•„ë¼ë¹„ì¹´': ['ì•„ë¼ë¹„ì¹´', 'arabica', 'kcn25', 'kcn', '7ì›”ë¬¼'],
                'ë¡œë¶€ìŠ¤íƒ€': ['ë¡œë¶€ìŠ¤íƒ€', 'robusta', 'rmn25', 'rmn', 'ëŸ°ë˜'],
                'ë¸Œë¼ì§ˆ': ['ë¸Œë¼ì§ˆ', 'brazil', 'ë¸Œë¼ì§ˆë¦¬ì–¸', 'ë¯¸ë‚˜ìŠ¤', 'ì„¸í•˜ë„', 'í—¤ì•Œ'],
                'ë² íŠ¸ë‚¨': ['ë² íŠ¸ë‚¨', 'vietnam', 'ë² íŠ¸ë‚¨ì‚°', 'ì¤‘ë¶€ê³ ì›', 'ë‹¬ë'],
                'ìƒì‚°ëŸ‰': ['ìƒì‚°ëŸ‰', 'ìˆ˜í™•', 'ì‘í™©', 'ìƒì‚°', 'harvest', 'crop'],
                'ê°€ê²©ë¶„ì„': ['ê°€ê²©', 'ì„¼íŠ¸', 'ìƒìŠ¹', 'í•˜ë½', 'ë³€ë™ì„±', 'ê¸‰ë“±', 'ê¸‰ë½'],
                'ìˆ˜ì¶œì…': ['ìˆ˜ì¶œ', 'ìˆ˜ì…', 'ë¬´ì—­', 'export', 'import', 'ìˆ˜ì¶œëŸ‰'],
                'ì¬ê³ ': ['ì¬ê³ ', 'inventory', 'stock', 'iceì¬ê³ ', 'ì¸ì¦ì¬ê³ '],
                'ê¸°ìˆ ì ë¶„ì„': ['ê¸°ìˆ ì ', 'ì§€ì§€ì„ ', 'ì €í•­ì„ ', 'ì°¨íŠ¸', 'íŒ¨í„´', 'stochastic'],
                'ê¸°ìƒ': ['ê¸°ìƒ', 'ë‚ ì”¨', 'ê°•ìš°', 'ê°€ë­„', 'ì„œë¦¬', 'ì—˜ë‹ˆë‡¨', 'ë¼ë‹ˆëƒ'],
                'íˆ¬ê¸°': ['íˆ¬ê¸°', 'cftc', 'í¬ì§€ì…˜', 'í—¤ì§€í€ë“œ', 'ë§¤ìˆ˜', 'ë§¤ë„'],
                'ì‹œì¥ë™í–¥': ['ì‹œì¥', 'ë™í–¥', 'ì „ë§', 'ë¶„ì„', 'ì—…ê³„', 'íŠ¸ë Œë“œ'],
                'ê¸°ì—…': ['ìŠ¤íƒ€ë²…ìŠ¤', 'ë„¤ìŠ¬ë ˆ', 'jde', 'peet', 'nestlÃ©', 'sbux'],
                'ì •ì±…': ['ì •ë¶€', 'ì •ì±…', 'ê´€ì„¸', 'ë³´ì¡°ê¸ˆ', 'ê·œì œ', 'usda'],
                'ì§€ì§€ì €í•­': ['ì§€ì§€ì„ ', 'ì €í•­ì„ ', 'ëŒíŒŒ', 'ì´íƒˆ', 'í…ŒìŠ¤íŠ¸'],
                'ê³µê¸‰ìˆ˜ìš”': ['ê³µê¸‰', 'ìˆ˜ìš”', 'ì ì', 'í‘ì', 'ë¶€ì¡±', 'ê³¼ì‰'],
                'ì„ ë¬¼ê±°ë˜': ['ì„ ë¬¼', 'futures', 'ice', 'ê±°ë˜ëŸ‰', 'ë¯¸ê²°ì œì•½ì •']
            };
            
            // í‚¤ì›Œë“œ ë¹ˆë„ ë° ì¤‘ìš”ë„ ê³„ì‚°
            const keywordScores = {};
            
            Object.entries(keywordCategories).forEach(([category, keywords]) => {
                let score = 0;
                keywords.forEach(keyword => {
                    // ì œëª©ì—ì„œ ë°œê²¬ì‹œ ê°€ì¤‘ì¹˜ 3ë°°
                    if (titleText.includes(keyword)) score += 3;
                    // ìš”ì•½ì—ì„œ ë°œê²¬ì‹œ ê°€ì¤‘ì¹˜ 2ë°°  
                    if (summaryText.includes(keyword)) score += 2;
                    // ë³¸ë¬¸ì—ì„œ ë°œê²¬ì‹œ ê¸°ë³¸ ì ìˆ˜
                    const bodyMatches = (bodyText.match(new RegExp(keyword, 'g')) || []).length;
                    score += bodyMatches * 0.5;
                });
                
                if (score > 0) {
                    keywordScores[category] = score;
                }
            });
            
            // íŒŒì¼ëª… ê¸°ë°˜ ì¶”ê°€ íƒœê·¸
            if (filePath.includes('2025-06-13')) {
                keywordScores['ì „ë§ë¶„ì„'] = (keywordScores['ì „ë§ë¶„ì„'] || 0) + 2;
                keywordScores['ì‹¬ì¸µë¶„ì„'] = (keywordScores['ì‹¬ì¸µë¶„ì„'] || 0) + 2;
            }
            
            // íŠ¹ë³„ íŒ¨í„´ ê°ì§€
            if (bodyText.includes('executive summary') || bodyText.includes('í•µì‹¬ ìš”ì•½')) {
                keywordScores['ì¢…í•©ë¶„ì„'] = (keywordScores['ì¢…í•©ë¶„ì„'] || 0) + 1;
            }
            
            if (bodyText.includes('ì£¼ê°„') || bodyText.includes('weekly')) {
                keywordScores['ì£¼ê°„ë™í–¥'] = (keywordScores['ì£¼ê°„ë™í–¥'] || 0) + 2;
            }
            
            if (bodyText.includes('ë‹¨ê¸°') || bodyText.includes('short-term')) {
                keywordScores['ë‹¨ê¸°ì „ë§'] = (keywordScores['ë‹¨ê¸°ì „ë§'] || 0) + 2;
            }
            
            // ìˆ˜ì¹˜/í†µê³„ ì–¸ê¸‰ì‹œ
            if (bodyText.match(/\d+%|\d+ì„¼íŠ¸|\d+í¬ì¸íŠ¸/)) {
                keywordScores['ìˆ˜ì¹˜ë¶„ì„'] = (keywordScores['ìˆ˜ì¹˜ë¶„ì„'] || 0) + 1;
            }
            
            // ì ìˆ˜ ê¸°ì¤€ ìƒìœ„ íƒœê·¸ ì„ íƒ
            const sortedTags = Object.entries(keywordScores)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8)
                .map(([tag,]) => tag);
            
            // ê¸°ì¡´ íƒœê·¸ì™€ ìƒˆ íƒœê·¸ í•©ì¹˜ê¸°
            sortedTags.forEach(tag => tags.add(tag));
            
            // ìµœì†Œ íƒœê·¸ ë³´ì¥
            if (tags.size < 3) {
                tags.add('ì»¤í”¼ì„ ë¬¼');
                tags.add('ì‹œì¥ë¶„ì„'); 
                tags.add('ê¸€ë¡œë²Œë™í–¥');
            }
            
            console.log(`${filePath} íƒœê·¸ ì¶”ì¶œ ì™„ë£Œ:`, Array.from(tags));
            return Array.from(tags);
        }

        // í´ë”ì—ì„œ HTML íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        async function scanFolderForHTMLFiles(folderPath) {
            const files = [];
            
            // ë‚ ì§œ íŒ¨í„´ìœ¼ë¡œ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ (1ì¼ë¶€í„° 31ì¼ê¹Œì§€)
            for (let day = 1; day <= 31; day++) {
                const dayStr = String(day).padStart(2, '0');
                
                // í´ë” ê²½ë¡œì—ì„œ ì—°ë„/ì›” ì¶”ì¶œ
                const pathMatch = folderPath.match(/Reports\/(\d{4})\/(\d{2})\//);
                if (!pathMatch) continue;
                
                const [, year, month] = pathMatch;
                const fileName = `${year}-${month}-${dayStr}.html`;
                const fullPath = `${folderPath}${fileName}`;
                
                try {
                    const response = await fetch(fullPath, { method: 'HEAD' });
                    if (response.ok) {
                        files.push(fullPath);
                    }
                } catch (error) {
                    // íŒŒì¼ì´ ì—†ìœ¼ë©´ ë¬´ì‹œ
                }
            }
            
            return files;
        }

        // reports.json ë¡œë“œ ì‹œë„, ì‹¤íŒ¨ì‹œ ë™ì  ìŠ¤ìº”
        async function loadReportsFromJSON() {
            try {
                console.log('reports.json ë¡œë”© ì‹œë„...');
                const response = await fetch('reports.json');
                if (response.ok) {
                    const data = await response.json();
                    if (data.reports && data.reports.length > 0) {
                        console.log(`reports.jsonì—ì„œ ${data.reports.length}ê°œ ë³´ê³ ì„œ ë¡œë“œë¨`);
                        return data.reports;
                    }
                }
            } catch (error) {
                console.warn('reports.json ë¡œë“œ ì‹¤íŒ¨, ë™ì  ìŠ¤ìº” ì‹œì‘:', error);
            }
            
            // reports.jsonì´ ì—†ê±°ë‚˜ ë¹„ì–´ìˆìœ¼ë©´ ë™ì  ìŠ¤ìº”
            console.log('ë™ì  ë³´ê³ ì„œ í´ë” ìŠ¤ìº” ì‹œì‘...');
            const scannedReports = await scanReportsFolder();
            
            if (scannedReports.length === 0) {
                // ìŠ¤ìº” ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° ë°˜í™˜
                console.log('ìŠ¤ìº” ê²°ê³¼ ì—†ìŒ, ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©');
                return [
                    {
                        date: '2025-06-13',
                        displayDate: '2025ë…„ 6ì›” 13ì¼',
                        title: 'ë‹¨ê¸° ì»¤í”¼ ì„ ë¬¼ ê°€ê²© ì „ë§ ë° ë°©í–¥ì„± ì ê²€',
                        subtitle: 'Short-term Coffee Futures Price Forecast',
                        summary: 'KCN25ëŠ” 349.90ì„¼íŠ¸ë¡œ +0.60% ìƒìŠ¹í•˜ë©° 1ì°¨ ì§€ì§€ì„ ì„ ìƒíšŒ íšŒë³µí–ˆìŠµë‹ˆë‹¤. ë‹¨ê¸°ì ìœ¼ë¡œëŠ” ë¸Œë¼ì§ˆ ìˆ˜í™• ì§„í–‰ê³¼ íˆ¬ê¸°ì  ìˆ í¬ì§€ì…˜ì´ í•˜ë°© ì••ë ¥ìœ¼ë¡œ ì‘ìš©í•˜ë‚˜, êµ¬ì¡°ì ìœ¼ë¡œëŠ” ê¸€ë¡œë²Œ ì•„ë¼ë¹„ì¹´ ì ìê°€ ê°•ì„¸ ìš”ì¸ìœ¼ë¡œ ì‘ìš©í•©ë‹ˆë‹¤.',
                        tags: ['ì•„ë¼ë¹„ì¹´', 'ë¡œë¶€ìŠ¤íƒ€', 'ë¸Œë¼ì§ˆìˆ˜í™•', 'íˆ¬ê¸°í¬ì§€ì…˜', 'ê¸°ìˆ ì ë¶„ì„'],
                        link: 'Reports/2025/06/2025-06-13.html',
                        year: '2025',
                        month: '06'
                    }
                ];
            }
            
            console.log(`ë™ì  ìŠ¤ìº” ì™„ë£Œ: ${scannedReports.length}ê°œ ë³´ê³ ì„œ`);
            return scannedReports;
        }

        function renderReports(filteredReports = allReports) {
            const grid = document.getElementById('reportsGrid');
            const noResults = document.getElementById('noResults');
            const loading = document.getElementById('reportsLoading');
            
            loading.style.display = 'none';
            
            if (filteredReports.length === 0) {
                grid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            noResults.style.display = 'none';
            
            grid.innerHTML = filteredReports.map(report => `
                <div class="report-card" onclick="window.location.href='${report.link}'">
                    <div class="report-date">${report.displayDate}</div>
                    <h3 class="report-title">${report.title}</h3>
                    <p class="report-summary">${report.summary}</p>
                    <div class="report-tags">
                        ${report.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <a href="${report.link}" class="read-more">ë³´ê³ ì„œ ì½ê¸°</a>
                </div>
            `).join('');
        }

        function filterReports() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const yearFilter = document.getElementById('yearFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            const filtered = allReports.filter(report => {
                const matchesSearch = report.title.toLowerCase().includes(searchTerm) || 
                                    report.summary.toLowerCase().includes(searchTerm) ||
                                    report.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                const matchesYear = !yearFilter || report.year === yearFilter;
                const matchesMonth = !monthFilter || report.month === monthFilter;
                
                return matchesSearch && matchesYear && matchesMonth;
            });
            
            renderReports(filtered);
        }

        function updateFilters() {
            const years = [...new Set(allReports.map(r => r.year))].sort().reverse();
            const months = [...new Set(allReports.map(r => r.month))].sort();
            
            const yearSelect = document.getElementById('yearFilter');
            const monthSelect = document.getElementById('monthFilter');
            
            if (yearSelect) {
                yearSelect.innerHTML = '<option value="">ì „ì²´ ë…„ë„</option>';
                years.forEach(year => {
                    yearSelect.innerHTML += `<option value="${year}">${year}ë…„</option>`;
                });
            }
            
            if (monthSelect) {
                monthSelect.innerHTML = '<option value="">ì „ì²´ ì›”</option>';
                months.forEach(month => {
                    const monthName = parseInt(month) + 'ì›”';
                    monthSelect.innerHTML += `<option value="${month}">${monthName}</option>`;
                });
            }
        }

        function updateStats() {
            const totalElement = document.getElementById('totalReports');
            const latestElement = document.getElementById('latestDate');
            
            if (totalElement) {
                totalElement.textContent = allReports.length;
            }
            
            if (latestElement && allReports.length > 0) {
                latestElement.textContent = allReports[0].displayDate.substring(0, 7);
            }
        }

        // ì´ˆê¸°í™” í•¨ìˆ˜
        async function init() {
            try {
                console.log('=== ì´ˆê¸°í™” ì‹œì‘ ===');
                
                // Chart.js ë¡œë“œ í™•ì¸
                if (typeof Chart === 'undefined') {
                    console.error('Chart.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                    return;
                }
                console.log('Chart.js ë¡œë“œ í™•ì¸ë¨');
                
                // XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                if (typeof XLSX === 'undefined') {
                    console.error('XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                    return;
                }
                console.log('XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸ë¨');

                // ì°¨íŠ¸ë“¤ ìˆœì°¨ì ìœ¼ë¡œ ë¡œë“œ (ë³‘ë ¬ ëŒ€ì‹  ìˆœì°¨)
                console.log('=== ì°¨íŠ¸ ë¡œë”© ì‹œì‘ ===');
                await createCoffeeChart();
                await createUSDChart();
                await createCFTCChart();
                await createICOChart();
                console.log('=== ì°¨íŠ¸ ë¡œë”© ì™„ë£Œ ===');

                // ë³´ê³ ì„œ ë°ì´í„° ë¡œë“œ (ë™ì  ìŠ¤ìº” í¬í•¨)
                console.log('=== ë³´ê³ ì„œ ë¡œë”© ì‹œì‘ ===');
                allReports = await loadReportsFromJSON();
                updateFilters();
                updateStats();
                renderReports();
                console.log('=== ë³´ê³ ì„œ ë¡œë”© ì™„ë£Œ ===');
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                document.getElementById('searchInput').addEventListener('input', filterReports);
                document.getElementById('yearFilter').addEventListener('change', filterReports);
                document.getElementById('monthFilter').addEventListener('change', filterReports);
                
                console.log('=== ì´ˆê¸°í™” ì™„ë£Œ ===', allReports.length, 'ê°œ ë³´ê³ ì„œ');
                
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
                document.getElementById('reportsLoading').style.display = 'none';
                document.getElementById('noResults').style.display = 'block';
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™” ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ, ì´ˆê¸°í™” ì‹œì‘');
            init();
        });
        
        // ì¶”ê°€ ë¡œë“œ ì´ë²¤íŠ¸ë„ ë“±ë¡ (ë°±ì—…)
        window.addEventListener('load', function() {
            console.log('ìœˆë„ìš° ë¡œë“œ ì™„ë£Œ');
            // DOM ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì‹¤í–‰
            if (!window.initStarted) {
                window.initStarted = true;
                init();
            }
        });
        
        // ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ (ê°œë°œì ë„êµ¬ì—ì„œ ìˆ˜ë™ ì‹¤í–‰ìš©)
        window.testExcelLoad = async function() {
            console.log('=== ìˆ˜ë™ Excel í…ŒìŠ¤íŠ¸ ===');
            try {
                const data = await readExcelFile('coffeefutures.xlsx');
                console.log('í…ŒìŠ¤íŠ¸ ê²°ê³¼:', data ? `${data.length}ê°œ ë°ì´í„° í¬ì¸íŠ¸` : 'ì‹¤íŒ¨');
                return data;
            } catch (error) {
                console.error('í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                return null;
            }
        };


                            year: '2-digit', 
                            month: 'short' 
                        })
                    });
                }
            }

            loadingElement.style.display = 'none';
            chartElement.style.display = 'block';

            const ctx = chartElement.getContext('2d');
            charts.coffee = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Coffee Futures Price',
                        data: chartData,
                        borderColor: '#8B4513',
                        backgroundColor: 'rgba(139, 69, 19, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex;
                                    return chartData[index].date.toLocaleDateString('ko-KR');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Date'
                            },
                            ticks: {
                                callback: function(value, index, values) {
                                    const label = dateLabels.find(dl => dl.index === value);
                                    return label ? label.label : '';
                                },
                                maxTicksLimit: 8
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Price (cents/lb)'
                            }
                        }
                    }
                }
            });
        }

        async function createUSDChart() {
            const data = await readExcelFile('usdbrl.xlsx');
            const loadingElement = document.getElementById('loading-usd');
            const chartElement = document.getElementById('usdChart');
            
            if (!data) {
                loadingElement.innerHTML = '<div style="color: #e74c3c;">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</div>';
                return;
            }

            const chartData = data.map((row, index) => ({
                x: index,
                y: parseFloat(row.value),
                date: parseDate(row.date)
            })).filter(point => !isNaN(point.y));

            const dateLabels = [];
            const totalPoints = chartData.length;
            const interval = Math.max(1, Math.floor(totalPoints / 6));
            
            for (let i = 0; i < totalPoints; i += interval) {
                if (chartData[i]) {
                    const date = chartData[i].date;
                    dateLabels.push({
                        index: i,
                        label: date.toLocaleDateString('ko-KR', { 
                            year: '2-digit', 
                            month: 'short' 
                        })
                    });
                }
            }

            loadingElement.style.display = 'none';
            chartElement.style.display = 'block';

            const ctx = chartElement.getContext('2d');
            charts.usd = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'USD/BRL Rate',
                        data: chartData,
                        borderColor: '#2E8B57',
                        backgroundColor: 'rgba(46, 139, 87, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex;
                                    return chartData[index].date.toLocaleDateString('ko-KR');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Date'
                            },
                            ticks: {
                                callback: function(value, index, values) {
                                    const label = dateLabels.find(dl => dl.index === value);
                                    return label ? label.label : '';
                                },
                                maxTicksLimit: 8
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'BRL per USD'
                            }
                        }
                    }
                }
            });
        }

        async function createCFTCChart() {
            const data = await readExcelFile('cftcpositions.xlsx');
            const loadingElement = document.getElementById('loading-cftc');
            const chartElement = document.getElementById('cftcChart');
            
            if (!data) {
                loadingElement.innerHTML = '<div style="color: #e74c3c;">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</div>';
                return;
            }

            const chartData = data.map((row, index) => ({
                x: index,
                y: parseInt(row.value),
                date: parseDate(row.date)
            })).filter(point => !isNaN(point.y));

            const dateLabels = [];
            const totalPoints = chartData.length;
            const interval = Math.max(1, Math.floor(totalPoints / 6));
            
            for (let i = 0; i < totalPoints; i += interval) {
                if (chartData[i]) {
                    const date = chartData[i].date;
                    dateLabels.push({
                        index: i,
                        label: date.toLocaleDateString('ko-KR', { 
                            year: '2-digit', 
                            month: 'short' 
                        })
                    });
                }
            }

            loadingElement.style.display = 'none';
            chartElement.style.display = 'block';

            const ctx = chartElement.getContext('2d');
            charts.cftc = new Chart(ctx, {
                type: 'bar',
                data: {
                    datasets: [{
                        label: 'Net Long Positions',
                        data: chartData,
                        backgroundColor: chartData.map(point => point.y >= 0 ? '#27AE60' : '#E74C3C'),
                        borderColor: chartData.map(point => point.y >= 0 ? '#229954' : '#C0392B'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex;
                                    return chartData[index].date.toLocaleDateString('ko-KR');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Date'
                            },
                            ticks: {
                                callback: function(value, index, values) {
                                    const label = dateLabels.find(dl => dl.index === value);
                                    return label ? label.label : '';
                                },
                                maxTicksLimit: 8
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Net Long Positions'
                            }
                        }
                    }
                }
            });
        }

        async function createICOChart() {
            const data = await readExcelFile('icoicip.xlsx');
            const loadingElement = document.getElementById('loading-ico');
            const chartElement = document.getElementById('icoChart');
            
            if (!data) {
                loadingElement.innerHTML = '<div style="color: #e74c3c;">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</div>';
                return;
            }

            const chartData = data.map((row, index) => ({
                x: index,
                y: parseFloat(row.value),
                date: parseDate(row.date)
            })).filter(point => !isNaN(point.y));

            const dateLabels = [];
            const totalPoints = chartData.length;
            const interval = Math.max(1, Math.floor(totalPoints / 6));
            
            for (let i = 0; i < totalPoints; i += interval) {
                if (chartData[i]) {
                    const date = chartData[i].date;
                    dateLabels.push({
                        index: i,
                        label: date.toLocaleDateString('ko-KR', {
