<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Market Updates Archive</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-date-fns/2.0.0/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            line-height: 1.7;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('coffee-beans-pattern.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            opacity: 0.08;
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('coffee-abstract-dark.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0.25;
            z-index: 0;
        }
        
        header > * {
            position: relative;
            z-index: 1;
        }
        
        h1 {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .live-indicator {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.3em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
            animation: pulse-live 2s infinite;
        }
        
        .live-indicator::before {
            content: '‚óè';
            color: #fff;
            font-size: 1.2em;
            margin-right: 4px;
            animation: blink 1.5s infinite;
        }
        
        @keyframes pulse-live {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .date-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.35em;
            font-weight: 500;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            font-weight: 300;
            margin-bottom: 15px;
        }
        
        .description {
            font-size: 1.1em;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #8B4513;
            position: relative;
            overflow: hidden;
        }
        
        .stat-box::after {
            content: '';
            position: absolute;
            bottom: -20px;
            right: -20px;
            width: 80px;
            height: 80px;
            background-image: url('coffee-beans-pattern.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.15;
            transform: rotate(-15deg);
        }
        
        .stat-number {
            font-size: 2.2em;
            font-weight: 700;
            color: #8B4513;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.95em;
            color: #666;
            font-weight: 500;
        }
        
        .search-filter {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            border-color: #8B4513;
            outline: none;
        }
        
        .filter-select {
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 1em;
            background: white;
            cursor: pointer;
        }
        
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .report-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #8B4513;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .report-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background-image: url('coffee-beans-pattern.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.08;
            transform: rotate(45deg);
            transition: opacity 0.3s ease;
        }
        
        .report-card:hover::before {
            opacity: 0.15;
        }
        
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .report-date {
            font-size: 0.9em;
            color: #8B4513;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .report-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.4;
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .new-badge {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            font-size: 0.7em;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
            animation: pulse 2s infinite;
            flex-shrink: 0;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 4px 8px rgba(231, 76, 60, 0.5);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
            }
        }
        
        .report-summary {
            font-size: 0.95em;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .report-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .tag {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .read-more {
            display: inline-flex;
            align-items: center;
            color: #8B4513;
            font-weight: 600;
            text-decoration: none;
            font-size: 0.95em;
            transition: color 0.3s ease;
        }
        
        .read-more:hover {
            color: #A0522D;
        }
        
        .read-more::after {
            content: " ‚Üí";
            margin-left: 5px;
            transition: margin-left 0.3s ease;
        }
        
        .read-more:hover::after {
            margin-left: 10px;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 1.1em;
        }
        
        /* Ï∞®Ìä∏ ÎåÄÏãúÎ≥¥Îìú Ïä§ÌÉÄÏùº */
        .dashboard-section {
            margin-bottom: 50px;
            position: relative;
        }
        
        .dashboard-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 600px;
            height: 600px;
            background-image: url('coffee-beans-pattern.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.06;
            transform: translate(-50%, -50%) rotate(15deg);
            z-index: -1;
        }
        
        .section-title {
            font-size: 2em;
            font-weight: 700;
            color: #8B4513;
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 3px solid #8B4513;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .chart-container:hover {
            transform: translateY(-5px);
        }
        
        .chart-header {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .chart-source {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .chart-analysis {
            margin-top: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            border-left: 4px solid #8B4513;
            font-size: 0.9em;
            line-height: 1.5;
            color: #495057;
        }
        
        .chart-analysis .analysis-title {
            font-weight: 600;
            color: #8B4513;
            margin-bottom: 6px;
            font-size: 0.95em;
        }
        
        .chart-analysis .analysis-text {
            font-size: 0.85em;
            color: #6c757d;
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 400px;
            font-size: 1.1em;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #8B4513;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            padding: 30px 20px;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #eee;
            margin-top: 40px;
            background: white;
            border-radius: 15px;
        }
        
        .footer-links {
            margin-top: 15px;
        }
        
        .footer-links a {
            color: #8B4513;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 500;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2em;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .reports-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                Coffee Market Updates
                <span class="live-indicator">Live</span>
                <span class="date-badge" id="currentDate"></span>
            </h1>
            <p class="subtitle">Coffee Futures Market Analysis & Dashboard</p>
            <p class="description">
                Ïª§Ìîº ÏÑ†Î¨º ÏãúÏû• Î∂ÑÏÑù Î≥¥Í≥†ÏÑú ÏïÑÏπ¥Ïù¥Î∏å Î∞è Ïã§ÏãúÍ∞Ñ ÏãúÏû• ÎåÄÏãúÎ≥¥ÎìúÏûÖÎãàÎã§. <br/>
                Ï£ºÍ∞Ñ ÏãúÏû• ÎèôÌñ•, Í∞ÄÍ≤© Î≥ÄÎèô Î∞è Í∏ÄÎ°úÎ≤å ÏàòÍ∏â ÌòÑÌô©ÏùÑ Ï†ïÍ∏∞Ï†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Ìï©ÎãàÎã§.
            </p>
        </header>

        <div class="stats-bar">
            <div class="stat-box">
                <div class="stat-number" id="totalReports">0</div>
                <div class="stat-label">Ï¥ù Î≥¥Í≥†ÏÑú Ïàò</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="latestDate">-</div>
                <div class="stat-label">ÏµúÏã† ÏóÖÎç∞Ïù¥Ìä∏</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">Ï£ºÍ∞Ñ</div>
                <div class="stat-label">ÏóÖÎç∞Ïù¥Ìä∏ Ï£ºÍ∏∞</div>
            </div>
            <div class="stat-box">
                <div class="stat-number">KR/EN</div>
                <div class="stat-label">Ïñ∏Ïñ¥ ÏßÄÏõê</div>
            </div>
        </div>

        <div class="search-filter">
            <div class="filter-row">
                <input type="text" class="search-input" id="searchInput" placeholder="Î≥¥Í≥†ÏÑú Ï†úÎ™©Ïù¥ÎÇò ÎÇ¥Ïö©ÏúºÎ°ú Í≤ÄÏÉâÌïòÏÑ∏Ïöî...">
                <select class="filter-select" id="yearFilter">
                    <option value="">Ï†ÑÏ≤¥ ÎÖÑÎèÑ</option>
                </select>
                <select class="filter-select" id="monthFilter">
                    <option value="">Ï†ÑÏ≤¥ Ïõî</option>
                </select>
            </div>
        </div>

        <div class="reports-grid" id="reportsGrid">
            </div>

        <div class="no-results" id="noResults" style="display: none;">
            <h3>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</h3>
            <p>Îã§Î•∏ Í≤ÄÏÉâÏñ¥ÎÇò ÌïÑÌÑ∞Î•º ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî.</p>
        </div>

        <div class="dashboard-section">
            <h2 class="section-title">üìä Market Dashboard</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Coffee Futures</div>
                        <div class="chart-source">Ï∂úÏ≤ò: ICE</div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="loading-spinner" id="loading-coffee">
                            <div class="spinner"></div>
                            Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...
                        </div>
                        <canvas id="coffeeChart" style="display: none;"></canvas>
                    </div>
                    <div class="chart-analysis">
                        <div class="analysis-title">üìä Ï∞®Ìä∏ Î∂ÑÏÑù</div>
                        <div class="analysis-text">
                            <strong>Ïª§Ìîº ÏÑ†Î¨º Í∞ÄÍ≤©</strong>ÏùÄ Í∏ÄÎ°úÎ≤å Ïª§Ìîº ÏãúÏû•Ïùò ÎØ∏Îûò Í∞ÄÍ≤© Í∏∞ÎåÄÏπòÎ•º Î∞òÏòÅÌï©ÎãàÎã§. 
                            Î∏åÎùºÏßà/Î≤†Ìä∏ÎÇ® Îì± Ï£ºÏöî ÏÉùÏÇ∞Íµ≠Ïùò ÏûëÌô©, Í∏∞ÌõÑ Î≥ÄÌôî, Í∏ÄÎ°úÎ≤å ÏàòÏöî Î≥ÄÌôîÍ∞Ä Ï£ºÏöî Î≥ÄÎèô ÏöîÏù∏ÏûÖÎãàÎã§. 
                            ÌòÑÏû¨ Ï∂îÏÑ∏Îäî ÏãúÏû•Ïùò Í≥µÍ∏â/ÏàòÏöî Í∑†ÌòïÍ≥º Ìà¨Í∏∞Ï†Å Ìè¨ÏßÄÏÖò Î≥ÄÌôîÎ•º ÎÇòÌÉÄÎÉÖÎãàÎã§.
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">ÎØ∏Íµ≠Îã¨Îü¨-Î∏åÎùºÏßàÌó§Ïïå ÌôòÏú®</div>
                        <div class="chart-source">Ï∂úÏ≤ò: LSEG</div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="loading-spinner" id="loading-usd">
                            <div class="spinner"></div>
                            Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...
                        </div>
                        <canvas id="usdChart" style="display: none;"></canvas>
                    </div>
                    <div class="chart-analysis">
                        <div class="analysis-title">üí± Ï∞®Ìä∏ Î∂ÑÏÑù</div>
                        <div class="analysis-text">
                            <strong>USD/BRL ÌôòÏú®</strong>ÏùÄ Ïª§Ìîº ÏãúÏû•Ïóê Ï§ëÏöîÌïú ÏòÅÌñ•ÏùÑ ÎØ∏Ïπ©ÎãàÎã§. 
                            Ìó§ÏïåÌôî ÏïΩÏÑ∏(USD/BRL ÏÉÅÏäπ) Ïãú Î∏åÎùºÏßà ÎÜçÎØºÎì§Ïùò Îã¨Îü¨ ÏàòÏ∑®Ïï°Ïù¥ Ï¶ùÍ∞ÄÌï¥ ÏàòÏ∂ú Í≤ΩÏüÅÎ†•Ïù¥ Í∞ïÌôîÎêòÍ≥†, 
                            Î∞òÎåÄÎ°ú Ìó§ÏïåÌôî Í∞ïÏÑ∏ ÏãúÏóêÎäî Î∏åÎùºÏßà Ïª§ÌîºÏùò Íµ≠Ï†ú Í≤ΩÏüÅÎ†•Ïù¥ ÏïΩÌôîÎê©ÎãàÎã§. 
                            Î∏åÎùºÏßàÏù¥ ÏÑ∏Í≥Ñ ÏµúÎåÄ Ïª§Ìîº ÏÉùÏÇ∞Íµ≠Ïù¥ÎØÄÎ°ú ÌôòÏú® Î≥ÄÎèôÏùÄ Í∏ÄÎ°úÎ≤å Ïª§Ìîº Í∞ÄÍ≤©Ïóê ÏßÅÏ†ëÏ†Å ÏòÅÌñ•ÏùÑ Ï§çÎãàÎã§.
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">CFTC Ìà¨Í∏∞ Ìè¨ÏßÄÏÖò (ÏàúÎß§Ïàò)</div>
                        <div class="chart-source">Ï∂úÏ≤ò: LSEG</div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="loading-spinner" id="loading-cftc">
                            <div class="spinner"></div>
                            Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...
                        </div>
                        <canvas id="cftcChart" style="display: none;"></canvas>
                    </div>
                    <div class="chart-analysis">
                        <div class="analysis-title">üìà Ï∞®Ìä∏ Î∂ÑÏÑù</div>
                        <div class="analysis-text">
                            <strong>CFTC Î®∏ÎãàÎß§ÎãàÏ†Ä ÏàúÎß§Ïàò Ìè¨ÏßÄÏÖò</strong>ÏùÄ ÎåÄÌòï ÌéÄÎìúÎì§Ïùò Ïª§Ìîº ÏãúÏû• Ïã¨Î¶¨Î•º Î≥¥Ïó¨Ï§çÎãàÎã§. 
                            ÏñëÏàòÎäî Í∞ïÏÑ∏ Î≤†ÌåÖ(Îß§Ïàò Ïö∞ÏÑ∏), ÏùåÏàòÎäî ÏïΩÏÑ∏ Î≤†ÌåÖ(Îß§ÎèÑ Ïö∞ÏÑ∏)ÏùÑ ÏùòÎØ∏Ìï©ÎãàÎã§. 
                            Í∑πÎã®Ï†Å Ìè¨ÏßÄÏÖòÏùÄ Ï¢ÖÏ¢Ö ÏãúÏû• Ï†ÑÌôòÏ†êÏùò Ïã†Ìò∏Í∞Ä ÎêòÎ©∞, 
                            ÌòÑÏû¨ Ìè¨ÏßÄÏÖò ÏàòÏ§ÄÏùÄ Ìà¨Í∏∞ ÏûêÍ∏àÏùò Î∞©Ìñ•ÏÑ±Í≥º ÏãúÏû• Í≥ºÏó¥/Í≥ºÎß§ÎèÑ ÏÉÅÌÉúÎ•º ÌåêÎã®ÌïòÎäî Ï§ëÏöîÌïú ÏßÄÌëúÏûÖÎãàÎã§.
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Î∏åÎùºÏßà ÎÇ®ÎèôÎ∂Ä NVDI (ÏãùÎ¨ºÌôúÎ†•ÎèÑ)</div>
                        <div class="chart-source">Ï∂úÏ≤ò: LSEG</div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="loading-spinner" id="loading-nvdi">
                            <div class="spinner"></div>
                            Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...
                        </div>
                        <canvas id="nvdiChart" style="display: none;"></canvas>
                    </div>
                    <div class="chart-analysis">
                        <div class="analysis-title">üå± Ï∞®Ìä∏ Î∂ÑÏÑù</div>
                        <div class="analysis-text">
                            <strong>NVDI (Ï†ïÍ∑úÏãùÏÉùÏßÄÏàò)</strong>Îäî ÏúÑÏÑ± Îç∞Ïù¥ÌÑ∞Î°ú Ï∏°Ï†ïÌïú ÏãùÎ¨ºÏùò Í±¥Í∞ïÎèÑÏôÄ ÌôúÎ†•ÎèÑÎ•º ÎÇòÌÉÄÎÉÖÎãàÎã§. 
                            Î∏åÎùºÏßà ÎÇ®ÎèôÎ∂ÄÎäî ÏÑ∏Í≥Ñ ÏµúÎåÄ ÏïÑÎùºÎπÑÏπ¥ Ïª§Ìîº ÏÉùÏÇ∞ÏßÄÏó≠ÏúºÎ°ú, NVDI ÏàòÏπòÍ∞Ä ÎÜíÏùÑÏàòÎ°ù Ïª§ÌîºÎÇòÎ¨¥Í∞Ä Í±¥Í∞ïÌïòÍ≥† 
                            ÏàòÌôïÎüâ Ï¶ùÍ∞ÄÍ∞Ä ÏòàÏÉÅÎê©ÎãàÎã§. Ïó≠ÏÇ¨Ï†Å Î≤îÏúÑ ÎåÄÎπÑ ÌòÑÏû¨ ÏàòÏπòÎ•º ÌÜµÌï¥ 
                            Ïò¨Ìï¥ ÏûëÌô© ÏÉÅÌÉúÏôÄ Ìñ•ÌõÑ Í≥µÍ∏âÎüâ Ï†ÑÎßùÏùÑ ÏòàÏ∏°Ìï† Ïàò ÏûàÎäî ÌïµÏã¨ ÏßÄÌëúÏûÖÎãàÎã§.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Published by Align Commodities & Yellowknife </strong></p>
            <p>Ï†ÑÎ¨∏Ï†ÅÏù∏ Ïª§Ìîº ÏãúÏû• Î∂ÑÏÑùÍ≥º Market IntelligenceÎ•º Ï†úÍ≥µÌï©ÎãàÎã§.</p>
            <div class="footer-links">
                <a href="mailto:james.baek@aligncommodities.com">Contact</a>
                <a href="https://github.com/jamesjongmin/Coffee-Market-Updates">GitHub</a>
                <a href="#latest">Latest Report</a>
            </div>
            <p style="margin-top: 15px; font-size: 0.8em; opacity: 0.7;">
                Î≥∏ Î¶¨Ìè¨Ìä∏Îäî Ï†ïÎ≥¥ Ï†úÍ≥µ Î™©Ï†ÅÏúºÎ°ú ÏûëÏÑ±ÎêòÏóàÏúºÎ©∞, Ìà¨Ïûê Í∂åÏú†Í∞Ä ÏïÑÎãôÎãàÎã§.
            </p>
        </footer>
    </div>
<script>
    let allReports = [];
    let charts = {};

    // Íµ¨Í∏Ä ÏãúÌä∏ URL ÏÑ§Ï†ï
    const GOOGLE_SHEETS_URLS = {
        coffeefutures: 'https://docs.google.com/spreadsheets/d/1lnRrdQynfk-XrgYsKmf1_XFCBDa9jLr2XVRib-2lpTk/export?format=csv&gid=442491515',
        usdbrl: 'https://docs.google.com/spreadsheets/d/1FvqTjVTw_iCtZ9pQOHc1UBN7ghYvrdp_MOLTxsSLTyM/export?format=csv&gid=88171284',
        cftcpositions: 'https://docs.google.com/spreadsheets/d/1IgfIFB60VC2f3IGnU5m9xmqkmfOCnnAOYItj9SWKMxc/export?format=csv&gid=0',
        nvdi: 'https://docs.google.com/spreadsheets/d/1oxXXeBQDZmiq9te6fNkKTs9D1X8ruwUI0_yy8UOj7gI/export?format=csv&gid=0'
    };

    // CSV ÌååÏã± Ìï®Ïàò
    function parseCSV(csvText) {
        const lines = csvText.split('\n');
        const result = [];
        
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line) {
                const cells = line.split(',');
                result.push(cells);
            }
        }
        
        return result;
    }

    // Íµ¨Í∏Ä ÏãúÌä∏ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ ÏùΩÍ∏∞ Ìï®Ïàò (2Ïª¨Îüº: Date, Value)
    async function readGoogleSheetData(sheetKey) {
        try {
            const url = GOOGLE_SHEETS_URLS[sheetKey];
            if (!url) {
                throw new Error(`Unknown sheet key: ${sheetKey}`);
            }

            console.log(`Fetching data from Google Sheets: ${sheetKey}`);
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const csvText = await response.text();
            const data = parseCSV(csvText);
            
            // Ï≤´ Î≤àÏß∏ ÌñâÏùÄ Ìó§ÎçîÏù¥ÎØÄÎ°ú Ï†úÏô∏ÌïòÍ≥† Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
            const dataRows = data.slice(1);
            
            const processedData = dataRows.map(row => ({
                date: row[0], // Ï≤´ Î≤àÏß∏ Ïª¨ÎüºÏùÄ Ìï≠ÏÉÅ Date
                value: row[1] // Îëê Î≤àÏß∏ Ïª¨ÎüºÏùÄ Ìï¥Îãπ Í∞í
            })).filter(row => row.date && row.value !== undefined && row.value !== null && row.value !== '');
            
            // ÎÇ†ÏßúÏàúÏúºÎ°ú Ï†ïÎ†¨ (Ïò§ÎûòÎêú Í≤É ‚Üí ÏµúÏã† ÏàúÏÑúÎ°ú)
            processedData.sort((a, b) => parseDate(a.date) - parseDate(b.date));
            
            console.log(`Successfully loaded ${processedData.length} data points from ${sheetKey}`);
            return processedData;
            
        } catch (error) {
            console.error(`Error reading Google Sheet ${sheetKey}:`, error);
            return null;
        }
    }

    // Í∞úÏÑ†Îêú Î¶¨Ìè¨Ìä∏ Î°úÎî© ÏãúÏä§ÌÖú - Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ïö∞ÏÑ†, Îã§Ï§ë Ìè¥Î∞±
    async function loadReportsFromFiles() {
        // Ïã§Ï†ú Î¶¨Ìè¨Ìä∏ ÌååÏùº Î™©Î°ù (Ïò¨Î∞îÎ•∏ Í≤ΩÎ°ú, ÏµúÏã†Ïàú Ï†ïÎ†¨)
        const reportFiles = [
            'Reports/2025/07/2025-07-16.html',
            'Reports/2025/07/2025-07-12.html',
            'Reports/2025/07/2025-07-09.html',
            'Reports/2025/07/2025-07-04.html',
            'Reports/2025/06/2025-06-30.html',
            'Reports/2025/06/2025-06-28.html',
            'Reports/2025/06/2025-06-24.html', 
            'Reports/2025/06/2025-06-21.html',
            'Reports/2025/06/2025-06-14.html',
            'Reports/2025/06/2025-06-13.html',
            'Reports/2025/06/2025-06-09.html',
            'Reports/2025/06/2025-06-08.html',
            'Reports/2025/05/2025-05-31.html'
        ];
        
        const reports = [];
        
        for (const filePath of reportFiles) {
            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    console.log(`ÌååÏùº ÏóÜÏùå: ${filePath}`);
                    continue;
                }
                
                const htmlContent = await response.text();
                const metadata = extractReportMetadata(htmlContent, filePath);
                
                if (metadata) {
                    reports.push({
                        ...metadata,
                        link: filePath,
                        year: metadata.date.split('-')[0],
                        month: metadata.date.split('-')[1],
                        displayDate: formatKoreanDate(metadata.date)
                    });
                    console.log(`ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î°úÎìú: ${filePath}`);
                }
            } catch (error) {
                console.error(`Î°úÎî© Ïã§Ìå® ${filePath}:`, error);
            }
        }
        
        return reports.sort((a, b) => new Date(b.date) - new Date(a.date));
    }

    // Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú Ìï®Ïàò (Í∞úÏÑ†Îêú Ìè¥Î∞± ÏãúÏä§ÌÖú)
    function extractReportMetadata(htmlContent, filePath) {
        // 1Îã®Í≥Ñ: HTML Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Î∏îÎ°ù Í≤ÄÏÉâ
        const metaMatch = htmlContent.match(//);
        
        if (metaMatch) {
            try {
                const metadata = JSON.parse(metaMatch[1].trim());
                console.log(`Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Î∏îÎ°ùÏóêÏÑú Î°úÎìú: ${filePath}`);
                return metadata;
            } catch (error) {
                console.error(`Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ ÌååÏã± Ïã§Ìå® ${filePath}:`, error);
            }
        }
        
        // 2Îã®Í≥Ñ: Í∏∞Ï°¥ Î∞©Ïãù Ìè¥Î∞± (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        return extractLegacyMetadata(htmlContent, filePath);
    }

    // Í∏∞Ï°¥ Î∞©Ïãù Ìè¥Î∞± (ÏïàÏ†ÑÌïú Ï∂îÏ∂ú)
    function extractLegacyMetadata(htmlContent, filePath) {
        // ÌäπÏàò ÌååÏùºÎì§ÏùÑ ÏúÑÌïú ÌïòÎìúÏΩîÎî©Îêú Î©îÌÉÄÎç∞Ïù¥ÌÑ∞
        const specialFiles = {
            'Reports/2025/06/2025-06-14.html': {
                title: 'Îã®Í∏∞ Ïª§Ìîº ÏÑ†Î¨º Í∞ÄÍ≤© Ï†ÑÎßù Î∞è Î∞©Ìñ•ÏÑ± Ï†êÍ≤Ä',
                summary: 'KCN25Îäî 349.90ÏÑºÌä∏Î°ú +0.60% ÏÉÅÏäπÌïòÎ©∞ 1Ï∞® ÏßÄÏßÄÏÑ†ÏùÑ ÏÉÅÌöå ÌöåÎ≥µÌñàÏäµÎãàÎã§. Îã®Í∏∞Ï†ÅÏúºÎ°úÎäî Î∏åÎùºÏßà ÏàòÌôï ÏßÑÌñâÍ≥º Ìà¨Í∏∞Ï†Å Ïàè Ìè¨ÏßÄÏÖòÏù¥ ÌïòÎ∞© ÏïïÎ†•ÏúºÎ°ú ÏûëÏö©ÌïòÎÇò, Íµ¨Ï°∞Ï†ÅÏúºÎ°úÎäî Í∏ÄÎ°úÎ≤å ÏïÑÎùºÎπÑÏπ¥ Ï†ÅÏûêÏôÄ 25ÎÖÑ ÎßåÏóê ÏµúÏ†Ä Ïû¨Í≥†Í∞Ä Í∞ïÏÑ∏ ÏöîÏù∏ÏúºÎ°ú ÏûëÏö©Ìï©ÎãàÎã§.',
                tags: ['Îã®Í∏∞Ï†ÑÎßù', 'Í∏∞Ïà†Ï†ÅÎ∂ÑÏÑù', 'Î∏åÎùºÏßàÏàòÌôï', 'ÏïÑÎùºÎπÑÏπ¥Ï†ÅÏûê', 'Ìà¨Í∏∞Ìè¨ÏßÄÏÖò']
            },
            'Reports/2025/06/2025-06-24.html': {
                title: 'Ïª§Ìîº Í∞ÄÍ≤©, Ìè≠Ìíç Ï†ÑÏïº - ÏïÑÎùºÎπÑÏπ¥ ÏãúÏû• Ïù∏Ìè¨Í∑∏ÎûòÌîΩ',
                summary: 'ÏïÑÎùºÎπÑÏπ¥ Ïª§Ìîº ÏãúÏû•ÏùÄ Í∞ïÎ†•Ìïú Í∞ïÏÑ∏ ÏöîÏù∏Í≥º Ïû†Ïû¨Ï†Å ÏïΩÏÑ∏ Î¶¨Ïä§ÌÅ¨Í∞Ä Ï∂©ÎèåÌïòÎ©∞ ÎÜíÏùÄ Î≥ÄÎèôÏÑ±ÏùÑ ÏòàÍ≥†ÌïòÍ≥† ÏûàÏäµÎãàÎã§. Îã®Í∏∞ Í∞ÄÍ≤© Ï†ÑÎßùÏùÄ 310-390ÏÑºÌä∏ Î≤îÏúÑÏù¥Î©∞, Î∏åÎùºÏßà ÏÑúÎ¶¨ ÏúÑÌóòÏù¥ ÌïµÏã¨ Î≥ÄÏàòÎ°ú ÏûëÏö©Ìï† Ï†ÑÎßùÏûÖÎãàÎã§.',
                tags: ['Ïù∏Ìè¨Í∑∏ÎûòÌîΩ', 'Í∞ÄÍ≤©Ï†ÑÎßù', 'Î∏åÎùºÏßàÏÑúÎ¶¨', 'Í≥µÍ∏âÎ∂ÄÏ°±', 'Î≥ÄÎèôÏÑ±']
            }
        };

        // ÌäπÏàò ÌååÏùºÏù∏ÏßÄ ÌôïÏù∏
        if (specialFiles[filePath]) {
            console.log(`ÌäπÏàò ÌååÏùº Ï≤òÎ¶¨: ${filePath}`);
            const fileData = specialFiles[filePath];
            const dateMatch = filePath.match(/(\d{4}-\d{2}-\d{2})/);
            return {
                title: fileData.title,
                subtitle: '',
                date: dateMatch ? dateMatch[1] : new Date().toISOString().split('T')[0],
                summary: fileData.summary,
                tags: fileData.tags
            };
        }

        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        
        const dateMatch = filePath.match(/(\d{4}-\d{2}-\d{2})/);
        const defaultDate = dateMatch ? dateMatch[1] : new Date().toISOString().split('T')[0];
        
        const titleSelectors = ['h1', '.main-story h2', 'header h1', 'title'];
        
        let title = '';
        for (const selector of titleSelectors) {
            const element = doc.querySelector(selector);
            if (element && element.textContent.trim()) {
                title = cleanText(element.textContent.trim());
                if (!title.includes('<') && !title.includes('{') && title.length > 5) {
                    break;
                }
            }
        }
        
        let summary = '';
        const summarySelectors = ['.highlight p', '.main-story p:first-of-type', '.summary', 'meta[name="description"]'];
        
        for (const selector of summarySelectors) {
            const element = doc.querySelector(selector);
            if (element) {
                const text = selector.includes('meta') ? 
                    element.getAttribute('content') : 
                    element.textContent;
                
                if (text && text.trim()) {
                    const cleanedText = cleanText(text.trim());
                    if (!cleanedText.includes('<') && 
                        !cleanedText.includes('{') && 
                        !cleanedText.includes('function') &&
                        cleanedText.length > 20 && 
                        cleanedText.length < 300) {
                        summary = cleanedText.substring(0, 200);
                        break;
                    }
                }
            }
        }
        
        const tags = Array.from(doc.querySelectorAll('.tag'))
            .map(tag => cleanText(tag.textContent.trim()))
            .filter(tag => tag && tag.length > 0 && tag.length < 20)
            .slice(0, 6);
        
        console.log(`Ìè¥Î∞± Î∞©ÏãùÏúºÎ°ú Ï∂îÏ∂úÎêú Îç∞Ïù¥ÌÑ∞: ${filePath}`);
        
        return {
            title: title || getDefaultTitle(filePath),
            subtitle: '',
            date: defaultDate,
            summary: summary || '',
            tags: tags
        };
    }

    function cleanText(text) {
        return text.replace(/\s+/g, ' ').trim();
    }

    function getDefaultTitle(filePath) {
        const dateMatch = filePath.match(/(\d{4}-\d{2}-\d{2})/);
        if (dateMatch) {
            return `Ïª§Ìîº ÏãúÏû• ÎèôÌñ• - ${dateMatch[1]}`;
        }
        return 'Ïª§Ìîº ÏãúÏû• ÎèôÌñ•';
    }

    function formatKoreanDate(dateString) {
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        } catch (error) {
            return dateString;
        }
    }

    function getDefaultReports() {
        return [
            {
                date: '2025-06-28', displayDate: '2025ÎÖÑ 6Ïõî 28Ïùº', title: 'Ïª§Ìîº ÏãúÏû• ÎèôÌñ• - 2025-06-28',
                summary: 'Ïª§Ìîº ÏãúÏû• Ï£ºÍ∞Ñ ÎèôÌñ• Î∞è Î∂ÑÏÑù Î≥¥Í≥†ÏÑúÏûÖÎãàÎã§.', tags: ['Ïª§Ìîº', 'ÏãúÏû•ÎèôÌñ•'],
                link: 'Reports/2025/06/2025-06-28.html', year: '2025', month: '06'
            }
        ];
    }
    
    async function initializeReports() {
        try {
            console.log('Î¶¨Ìè¨Ìä∏ Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
            let reports = await loadReportsFromFiles();
            console.log('ÌååÏùºÏóêÏÑú Î°úÎìúÎêú Î¶¨Ìè¨Ìä∏:', reports.length);
            if (reports.length === 0) {
                console.log('ÌååÏùº Î°úÎìú Ïã§Ìå®, Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©');
                reports = getDefaultReports();
            }
            console.log('ÏµúÏ¢Ö Î¶¨Ìè¨Ìä∏ Ïàò:', reports.length);
            return reports;
        } catch (error) {
            console.error('Î¶¨Ìè¨Ìä∏ Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•ò:', error);
            return getDefaultReports();
        }
    }

    function parseDate(dateValue) {
        if (typeof dateValue === 'number') {
            const date = new Date((dateValue - 25569) * 86400 * 1000);
            return date;
        } else if (typeof dateValue === 'string') {
            return new Date(dateValue);
        }
        return new Date(dateValue);
    }

    // Coffee Futures Ï∞®Ìä∏ (ÏõêÎ≥∏ Íµ¨Ï°∞ Ïú†ÏßÄ)
    async function createCoffeeChart() {
        const loadingElement = document.getElementById('loading-coffee');
        const chartElement = document.getElementById('coffeeChart');
        try {
            const data = await readGoogleSheetData('coffeefutures');
            if (!data) throw new Error('No data received');

            const chartData = data.map((row, index) => ({
                x: index,
                y: parseFloat(row.value),
                date: parseDate(row.date)
            })).filter(point => !isNaN(point.y));

            loadingElement.style.display = 'none';
            chartElement.style.display = 'block';

            const ctx = chartElement.getContext('2d');
            charts.coffee = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Coffee Futures Price',
                        data: chartData,
                        borderColor: '#8B4513',
                        backgroundColor: 'rgba(139, 69, 19, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.2,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: { legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (tooltipItems) => chartData[tooltipItems[0].dataIndex].date.toLocaleDateString('ko-KR')
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: 'Date' },
                            ticks: {
                                callback: function(value) {
                                    const index = Math.round(value);
                                    if (chartData[index]) {
                                        const total = chartData.length;
                                        const step = Math.max(1, Math.floor(total / 8));
                                        if (index === 0 || index === total - 1 || index % step === 0) {
                                            return chartData[index].date.toLocaleDateString('ko-KR', { year: '2-digit', month: 'short' });
                                        }
                                    }
                                    return '';
                                }
                            }
                        },
                        y: { title: { display: true, text: 'Price (cents/lb)' } }
                    }
                }
            });
        } catch (error) {
            console.error('Coffee chart error:', error);
            loadingElement.innerHTML = `<div style="color: #e74c3c;">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®: ${error.message}</div>`;
        }
    }

    // USD/BRL ÌôòÏú® Ï∞®Ìä∏ (ÏõêÎ≥∏ Íµ¨Ï°∞ Ïú†ÏßÄ)
    async function createUSDChart() {
        const loadingElement = document.getElementById('loading-usd');
        const chartElement = document.getElementById('usdChart');
        try {
            const data = await readGoogleSheetData('usdbrl');
            if (!data) throw new Error('No data received');

            const chartData = data.map((row, index) => ({
                x: index,
                y: parseFloat(row.value),
                date: parseDate(row.date)
            })).filter(point => !isNaN(point.y));

            loadingElement.style.display = 'none';
            chartElement.style.display = 'block';

            const ctx = chartElement.getContext('2d');
            charts.usd = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'USD/BRL Rate',
                        data: chartData,
                        borderColor: '#2E8B57',
                        backgroundColor: 'rgba(46, 139, 87, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.2,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: { legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (tooltipItems) => chartData[tooltipItems[0].dataIndex].date.toLocaleDateString('ko-KR')
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: 'Date' },
                            ticks: {
                                callback: function(value) {
                                    const index = Math.round(value);
                                    if (chartData[index]) {
                                        const total = chartData.length;
                                        const step = Math.max(1, Math.floor(total / 8));
                                        if (index === 0 || index === total - 1 || index % step === 0) {
                                            return chartData[index].date.toLocaleDateString('ko-KR', { year: '2-digit', month: 'short' });
                                        }
                                    }
                                    return '';
                                }
                            }
                        },
                        y: { title: { display: true, text: 'BRL per USD' } }
                    }
                }
            });
        } catch (error) {
            console.error('USD chart error:', error);
            loadingElement.innerHTML = `<div style="color: #e74c3c;">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®: ${error.message}</div>`;
        }
    }

    // CFTC Ìè¨ÏßÄÏÖò Ï∞®Ìä∏ (Ïò§Î•ò ÏàòÏ†ï Î∞è ÏõêÎ≥∏ Íµ¨Ï°∞ Ïú†ÏßÄ)
    async function createCFTCChart() {
        const loadingElement = document.getElementById('loading-cftc');
        const chartElement = document.getElementById('cftcChart');
        
        try {
            const data = await readGoogleSheetData('cftcpositions');
            if (!data) throw new Error('No data received');

            const chartData = data.map(row => ({
                y: parseInt(row.value),
                date: parseDate(row.date)
            })).filter(point => !isNaN(point.y) && point.date);

            chartData.sort((a, b) => a.date - b.date);
            
            const labels = chartData.map(d => d.date);

            loadingElement.style.display = 'none';
            chartElement.style.display = 'block';

            const ctx = chartElement.getContext('2d');
            const isMobile = window.innerWidth <= 768;

            charts.cftc = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels, // Use date objects for labels
                    datasets: [{
                        label: 'Net Long Positions',
                        data: chartData.map(d => d.y),
                        backgroundColor: chartData.map(point => point.y >= 0 ? '#27AE60' : '#E74C3C'),
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: { legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (tooltipItems) => {
                                    const index = tooltipItems[0].dataIndex;
                                    return chartData[index].date.toLocaleDateString('ko-KR');
                                },
                                label: (context) => 'Net Long: ' + context.parsed.y.toLocaleString()
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time', // Use time scale for better label handling
                            time: {
                                unit: 'month',
                                tooltipFormat: 'yyyy-MM-dd',
                                displayFormats: { month: 'yy-MM' }
                            },
                            title: { display: true, text: 'Date' },
                            ticks: {
                                font: { size: isMobile ? 9 : 11 },
                                maxRotation: 45,
                                minRotation: 0,
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Net Long Positions',
                                font: { size: isMobile ? 10 : 12 }
                            },
                            ticks: {
                                callback: (value) => value.toLocaleString()
                            }
                        }
                    }
                }
            });
        } catch (error) {
            console.error('CFTC chart error:', error);
            loadingElement.innerHTML = `<div style="color: #e74c3c;">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®: ${error.message}</div>`;
        }
    }
    
    // NVDI Ï∞®Ìä∏ (ÏõêÎ≥∏ Íµ¨Ï°∞ Ïú†ÏßÄ)
    async function createNVDIChart() {
        const loadingElement = document.getElementById('loading-nvdi');
        const chartElement = document.getElementById('nvdiChart');
        try {
            const nvdiData = await readNVDIGoogleSheet();
            if (!nvdiData || nvdiData.length === 0) throw new Error('NVDI Îç∞Ïù¥ÌÑ∞Î•º ÏùΩÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            
            const monthKR = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];
            
            const datasets = [{
                label: 'Historical Range (2010-2023)',
                data: nvdiData.map(item => item.maxValue),
                borderColor: 'rgba(149, 165, 166, 0.8)',
                backgroundColor: 'rgba(149, 165, 166, 0.3)',
                borderWidth: 1, fill: '+1', tension: 0.4, pointRadius: 0
            }, {
                label: '',
                data: nvdiData.map(item => item.minValue),
                borderColor: 'rgba(149, 165, 166, 0.8)',
                fill: false, tension: 0.4, pointRadius: 0
            }, {
                label: '2024',
                data: nvdiData.map(item => item.year2024),
                borderColor: '#E74C3C', borderWidth: 3, fill: false, tension: 0.4,
            }, {
                label: '2025',
                data: nvdiData.map(item => item.year2025),
                borderColor: '#3498DB', borderWidth: 3, fill: false, tension: 0.4,
            }];

            loadingElement.style.display = 'none';
            chartElement.style.display = 'block';

            const ctx = chartElement.getContext('2d');
            charts.nvdi = new Chart(ctx, {
                type: 'line',
                data: { labels: monthKR, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: {
                        legend: { position: 'bottom', labels: { filter: item => item.text } }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Ïõî' } },
                        y: { title: { display: true, text: 'NVDI Index' },
                             ticks: { callback: (value) => value.toFixed(2) }
                        }
                    }
                }
            });
        } catch (error) {
            console.error('NVDI chart error:', error);
            loadingElement.innerHTML = `<div style="color: #e74c3c;">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®: ${error.message}</div>`;
        }
    }

    // NVDI Íµ¨Í∏Ä ÏãúÌä∏ ÏùΩÍ∏∞ Ìï®Ïàò
    async function readNVDIGoogleSheet() {
        try {
            const url = GOOGLE_SHEETS_URLS.nvdi;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            
            const csvText = await response.text();
            const data = parseCSV(csvText);
            
            const headers = data[0];
            const yearColumns = {};
            headers.forEach((header, index) => {
                if (index > 0) {
                    const year = parseInt(header.trim());
                    if (!isNaN(year)) yearColumns[year] = index;
                }
            });

            const monthlyData = [];
            for (let month = 1; month <= 12; month++) {
                const monthRows = data.slice(1).filter(row => row[0] && parseInt(row[0].split('/')[1]) === month);
                
                if (monthRows.length > 0) {
                    const allValues = [];
                    for (const row of monthRows) {
                        for (let year = 2010; year <= 2023; year++) {
                            const colIndex = yearColumns[year];
                            if (colIndex && row[colIndex]) {
                                const value = parseFloat(row[colIndex]);
                                if (!isNaN(value)) allValues.push(value);
                            }
                        }
                    }
                    
                    const getAvgForYear = (year) => {
                        const colIndex = yearColumns[year];
                        if (!colIndex) return null;
                        let values = [];
                        monthRows.forEach(row => {
                            const val = parseFloat(row[colIndex]);
                            if (!isNaN(val)) values.push(val);
                        });
                        return values.length > 0 ? values.reduce((s, v) => s + v, 0) / values.length : null;
                    };

                    monthlyData.push({
                        month,
                        minValue: allValues.length > 0 ? Math.min(...allValues) : null,
                        maxValue: allValues.length > 0 ? Math.max(...allValues) : null,
                        year2024: getAvgForYear(2024),
                        year2025: getAvgForYear(2025)
                    });
                } else {
                    monthlyData.push({ month, minValue: null, maxValue: null, year2024: null, year2025: null });
                }
            }
            return monthlyData;
            
        } catch (error) {
            console.error('Error reading NVDI Google Sheet:', error);
            return null;
        }
    }
    
    // Î¶¨Ìè¨Ìä∏ Î†åÎçîÎßÅ
    function renderReports(filteredReports = allReports) {
        const grid = document.getElementById('reportsGrid');
        const noResults = document.getElementById('noResults');
        
        if (filteredReports.length === 0) {
            grid.style.display = 'none';
            noResults.style.display = 'block';
            return;
        }
        
        grid.style.display = 'grid';
        noResults.style.display = 'none';
        
        const latestDate = allReports.length > 0 ? allReports[0].date : null;
        
        grid.innerHTML = filteredReports.map(report => {
            const isLatest = report.date === latestDate;
            return `
            <div class="report-card" onclick="window.location.href='${report.link}'">
                <div class="report-date">${report.displayDate}</div>
                <h3 class="report-title">
                    <span>${report.title}</span>
                    ${isLatest ? '<span class="new-badge">NEW</span>' : ''}
                </h3>
                <p class="report-summary">${report.summary}</p>
                <div class="report-tags">
                    ${(report.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                <a href="${report.link}" class="read-more">Î≥¥Í≥†ÏÑú ÏùΩÍ∏∞</a>
            </div>
            `;
        }).join('');
    }

    // Î¶¨Ìè¨Ìä∏ ÌïÑÌÑ∞ÎßÅ
    function filterReports() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const yearFilter = document.getElementById('yearFilter').value;
        const monthFilter = document.getElementById('monthFilter').value;
        
        const filtered = allReports.filter(report => {
            const matchesSearch = report.title.toLowerCase().includes(searchTerm) || 
                                  report.summary.toLowerCase().includes(searchTerm) ||
                                  (report.tags || []).some(tag => tag.toLowerCase().includes(searchTerm));
            const matchesYear = !yearFilter || report.year === yearFilter;
            const matchesMonth = !monthFilter || report.month === monthFilter;
            
            return matchesSearch && matchesYear && matchesMonth;
        });
        
        renderReports(filtered);
    }

    // ÌïÑÌÑ∞ ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏
    function updateFilters() {
        const years = [...new Set(allReports.map(r => r.year))].sort().reverse();
        const months = [...new Set(allReports.map(r => r.month))].sort();
        
        const yearSelect = document.getElementById('yearFilter');
        const monthSelect = document.getElementById('monthFilter');
        
        if (yearSelect) {
            yearSelect.innerHTML = '<option value="">Ï†ÑÏ≤¥ ÎÖÑÎèÑ</option>';
            years.forEach(year => {
                yearSelect.innerHTML += `<option value="${year}">${year}ÎÖÑ</option>`;
            });
        }
        
        if (monthSelect) {
            monthSelect.innerHTML = '<option value="">Ï†ÑÏ≤¥ Ïõî</option>';
            months.forEach(month => {
                const monthName = parseInt(month) + 'Ïõî';
                monthSelect.innerHTML += `<option value="${month}">${monthName}</option>`;
            });
        }
    }

    // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
    function updateStats() {
        const totalElement = document.getElementById('totalReports');
        const latestElement = document.getElementById('latestDate');
        
        if (totalElement) {
            totalElement.textContent = allReports.length;
        }
        
        if (latestElement && allReports.length > 0) {
            // ÎÇ†ÏßúÎ•º 'YYYY.MM' ÌòïÏãùÏúºÎ°ú Ìè¨Îß∑ÌåÖ
            const latestDate = new Date(allReports[0].date);
            const year = latestDate.getFullYear();
            const month = (latestDate.getMonth() + 1).toString().padStart(2, '0');
            latestElement.textContent = `${year}.${month}`;
        }
    }

    // ÌòÑÏû¨ ÎÇ†Ïßú ÏóÖÎç∞Ïù¥Ìä∏
    function updateCurrentDate() {
        const dateElement = document.getElementById('currentDate');
        if (dateElement) {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'short'
            };
            const formattedDate = now.toLocaleDateString('ko-KR', options);
            dateElement.textContent = formattedDate;
        }
    }

    // Î©îÏù∏ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
    async function init() {
        try {
            console.log('Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
            
            updateCurrentDate();
            
            // Ï∞®Ìä∏Îì§ Î≥ëÎ†¨Î°ú Î°úÎìú
            Promise.all([
                createCoffeeChart(),
                createUSDChart(),
                createCFTCChart(),
                createNVDIChart()
            ]);

            allReports = await initializeReports();
            updateFilters();
            updateStats();
            renderReports();
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            document.getElementById('searchInput').addEventListener('input', filterReports);
            document.getElementById('yearFilter').addEventListener('change', filterReports);
            document.getElementById('monthFilter').addEventListener('change', filterReports);
            
            console.log('Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
            
        } catch (error) {
            console.error('Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•ò:', error);
        }
    }

    // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï¥àÍ∏∞Ìôî Ïã§Ìñâ
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
