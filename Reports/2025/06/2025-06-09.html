<script>
        let allReports = [];
        
        // 기본 보고서 데이터 (백업용)
        const defaultReports = [
            {
                date: '2025-05-31',
                displayDate: '2025년 5월 31일',
                title: '커피 선물 시장 주간 동향',
                subtitle: 'Coffee Futures Market Weekly Update',
                summary: '커피 선물 시장이 지난 한 달간의 하락세를 연장하며 새로운 저점을 기록했습니다. 5월 30일 (금) 7월 아라비카 커피 선물(KCN25)이 -5.95(-1.71%) 하락한 342.45 센트로 7주 최저치를 기록했으며, 로부스타 커피도 -56(1.23%) 하락했습니다.',
                tags: ['아라비카', '로부스타', '브라질생산', '시장동향', '베트남생산', '기후변화', 'USDA보고서'],
                link: 'Reports/2025/05/2025-05-31.html',
                year: '2025',
                month: '05'
            },
            {
                date: '2025-06-08',
                displayDate: '2025년 6월 8일',
                title: '커피 선물 시장 주간 동향',
                subtitle: 'Coffee Futures Market Weekly Update',
                summary: '커피 선물이 5주간 연속 하락세를 지속하며 금요일 소폭 하락했습니다. 7월 아라비카 커피는 5.95포인트(-1.71%) 하락한 342.45센트로 마감했으며, 브라질 생산량 증가와 베트남 생산량 급증이 주요 하락 요인으로 작용했습니다.',
                tags: ['아라비카', '로부스타', '브라질생산량', '베트남수출', 'ICE재고'],
                link: 'Reports/2025/06/2025-06-08.html',
                year: '2025',
                month: '06'
            }
        ];

        // GitHub API로 Reports 폴더에서 HTML 파일들을 자동으로 가져오기
        async function loadReportsFromGitHub() {
            try {
                const reports = [...defaultReports]; // 기존 데이터 유지
                
                // 년도별 폴더 스캔 (2024, 2025, 2026)
                for (let year = 2024; year <= 2026; year++) {
                    for (let month = 1; month <= 12; month++) {
                        const monthStr = month.toString().padStart(2, '0');
                        
                        try {
                            // GitHub API를 통해 각 월 폴더의 파일 목록 가져오기
                            const response = await fetch(
                                `https://api.github.com/repos/jamesjongmin/Coffee-Market-Updates/contents/Reports/${year}/${monthStr}`
                            );
                            
                            if (response.ok) {
                                const files = await response.json();
                                
                                // HTML 파일들만 필터링
                                const htmlFiles = files.filter(file => 
                                    file.name.endsWith('.html') && file.type === 'file'
                                );
                                
                                // 각 HTML 파일에 대한 보고서 정보 생성
                                for (const file of htmlFiles) {
                                    const fileName = file.name.replace('.html', '');
                                    const dateMatch = fileName.match(/(\d{4})-(\d{2})-(\d{2})/);
                                    
                                    if (dateMatch) {
                                        const [, fileYear, fileMonth, fileDay] = dateMatch;
                                        const fileDate = `${fileYear}-${fileMonth}-${fileDay}`;
                                        
                                        // 기존 데이터에 없는 새로운 파일만 추가
                                        const exists = reports.some(r => r.date === fileDate);
                                        
                                        if (!exists) {
                                            reports.push({
                                                date: fileDate,
                                                displayDate: `${fileYear}년 ${parseInt(fileMonth)}월 ${parseInt(fileDay)}일`,
                                                title: '커피 선물 시장 주간 동향',
                                                subtitle: 'Coffee Futures Market Weekly Update',
                                                summary: `${fileYear}년 ${parseInt(fileMonth)}월 ${parseInt(fileDay)}일 커피 시장 분석 보고서입니다.`,
                                                tags: ['아라비카', '로부스타', '시장분석', '주간동향'],
                                                link: file.path,
                                                year: fileYear,
                                                month: fileMonth,
                                                fileName: file.name
                                            });
                                        }
                                    }
                                }
                            }
                        } catch (error) {
                            // 해당 년월 폴더가 없는 경우는 무시
                            continue;
                        }
                    }
                }
                
                // 날짜순으로 정렬 (최신이 먼저)
                reports.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                return reports;
                
            } catch (error) {
                console.error('보고서 로딩 중 오류:', error);
                // API 실패시 기본 데이터 반환
                return defaultReports;
            }
        }

        function renderReports(filteredReports = allReports) {
            const grid = document.getElementById('reportsGrid');
            const noResults = document.getElementById('noResults');
            
            if (filteredReports.length === 0) {
                grid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            noResults.style.display = 'none';
            
            grid.innerHTML = filteredReports.map(report => `
                <div class="report-card" onclick="window.location.href='${report.link}'">
                    <div class="report-date">${report.displayDate}</div>
                    <h3 class="report-title">${report.title}</h3>
                    <p class="report-summary">${report.summary}</p>
                    <div class="report-tags">
                        ${report.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <a href="${report.link}" class="read-more">보고서 읽기</a>
                </div>
            `).join('');
        }

        function filterReports() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const yearFilter = document.getElementById('yearFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            const filtered = allReports.filter(report => {
                const matchesSearch = report.title.toLowerCase().includes(searchTerm) || 
                                    report.summary.toLowerCase().includes(searchTerm) ||
                                    report.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                const matchesYear = !yearFilter || report.year === yearFilter;
                const matchesMonth = !monthFilter || report.month === monthFilter;
                
                return matchesSearch && matchesYear && matchesMonth;
            });
            
            renderReports(filtered);
        }

        function updateFilters() {
            const years = [...new Set(allReports.map(r => r.year))].sort().reverse();
            const months = [...new Set(allReports.map(r => r.month))].sort();
            
            const yearSelect = document.getElementById('yearFilter');
            const monthSelect = document.getElementById('monthFilter');
            
            if (yearSelect) {
                // 기존 옵션 유지하면서 새로운 년도 추가
                const currentOptions = Array.from(yearSelect.options).map(opt => opt.value);
                years.forEach(year => {
                    if (!currentOptions.includes(year) && year !== '') {
                        const option = new Option(`${year}년`, year);
                        yearSelect.add(option);
                    }
                });
            }
            
            if (monthSelect) {
                // 기존 옵션 유지하면서 새로운 월 추가
                const currentOptions = Array.from(monthSelect.options).map(opt => opt.value);
                months.forEach(month => {
                    if (!currentOptions.includes(month) && month !== '') {
                        const monthName = parseInt(month) + '월';
                        const option = new Option(monthName, month);
                        monthSelect.add(option);
                    }
                });
            }
        }

        function updateStats() {
            const totalElement = document.getElementById('totalReports');
            const latestElement = document.getElementById('latestDate');
            
            if (totalElement) {
                totalElement.textContent = allReports.length;
            }
            
            if (latestElement && allReports.length > 0) {
                latestElement.textContent = allReports[0].displayDate.substring(0, 7);
            }
        }

        // 초기화 함수
        async function init() {
            try {
                // GitHub에서 보고서 목록 로드
                allReports = await loadReportsFromGitHub();
                
                // 필터 업데이트
                updateFilters();
                
                // 통계 업데이트
                updateStats();
                
                // 초기 렌더링
                renderReports();
                
                // 이벤트 리스너 설정
                document.getElementById('searchInput').addEventListener('input', filterReports);
                document.getElementById('yearFilter').addEventListener('change', filterReports);
                document.getElementById('monthFilter').addEventListener('change', filterReports);
                
            } catch (error) {
                console.error('초기화 중 오류:', error);
                // 오류 발생시 기본 데이터로 대체
                allReports = defaultReports;
                renderReports();
                updateStats();
            }
        }

        // 페이지 로드시 초기화 실행
        init();
</script>
